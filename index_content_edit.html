<!DOCTYPE html>
<html lang="ko">
<head>
    <!-- 이전 코드와 동일 -->
</head>
<body>
    <!-- 이전 코드와 동일 -->

    <script>
        // 이전 함수들은 그대로 유지

        function insertImage(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image();
                    img.onload = function() {
                        const container = document.createElement('div');
                        container.className = 'image-container';

                        const wrapper = document.createElement('div');
                        wrapper.className = 'image-wrapper';

                        img.style.maxWidth = '100%';
                        img.style.height = 'auto';
                        img.onclick = function() { addImageCaption(this); };

                        const caption = document.createElement('div');
                        caption.className = 'image-caption';
                        caption.textContent = '이미지를 클릭하여 주석 추가';

                        wrapper.appendChild(img);
                        container.appendChild(wrapper);
                        container.appendChild(caption);

                        // 현재 선택 영역에 이미지 삽입
                        const selection = window.getSelection();
                        if (selection.rangeCount > 0) {
                            const range = selection.getRangeAt(0);
                            range.deleteContents();
                            range.insertNode(container);
                        } else {
                            editor.appendChild(container);
                        }

                        // 편집기 높이 조정
                        adjustEditorHeight();
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        // 이전 코드와 동일
    </script>
</body>
</html>
